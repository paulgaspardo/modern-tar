# Benchmarks

These are informal benchmarks comparing the performance of `modern-tar` against other popular tar libraries in Node.js. The usecase is for debugging and general reference, not for rigorous performance analysis.

## Libraries Compared

- [`modern-tar`](https://github.com/ayuhito/modern-tar)
- [`node-tar`](https://github.com/isaacs/node-tar)
- [`tar-fs`](https://github.com/mafintosh/tar-fs)

## Usage

### Setup

The benchmarks use **npm** for a pure Node environment:

```bash
cd benchmarks
npm install
```

### Running Benchmarks

```bash
# Run all benchmarks
npm run bench
```

## Recent Results

These benchmarks were run on an Apple M3 Pro and can include a lot of noise. Results should only be used to compare relative performance rather than absolute numbers.

### Packing Benchmarks

```sh
--- Many Small Files (2500 x 1KB) ---
┌─────────┬──────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                        │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼──────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Pack Many Small Files (2500 x 1KB)' │ '67634672 ± 0.62%'  │ '67052000 ± 1726354'  │ '15 ± 0.58%'           │ '15 ± 0'               │ 222     │
│ 1       │ 'node-tar: Pack Many Small Files (2500 x 1KB)'   │ '84659799 ± 0.90%'  │ '83082312 ± 1155000'  │ '12 ± 0.74%'           │ '12 ± 0'               │ 178     │
│ 2       │ 'tar-fs: Pack Many Small Files (2500 x 1KB)'     │ '150646779 ± 0.69%' │ '148717979 ± 1505395' │ '7 ± 0.64%'            │ '7 ± 0'                │ 100     │
└─────────┴──────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Many Small Nested Files (2500 x 1KB) ---
┌─────────┬─────────────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                               │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Pack Many Small Nested Files (2500 x 1KB)' │ '68415186 ± 0.46%'  │ '67960146 ± 1313792'  │ '15 ± 0.44%'           │ '15 ± 0'               │ 220     │
│ 1       │ 'node-tar: Pack Many Small Nested Files (2500 x 1KB)'   │ '91288797 ± 0.64%'  │ '89856667 ± 669624'   │ '11 ± 0.59%'           │ '11 ± 0'               │ 165     │
│ 2       │ 'tar-fs: Pack Many Small Nested Files (2500 x 1KB)'     │ '160479930 ± 0.61%' │ '159864208 ± 2036812' │ '6 ± 0.64%'            │ '6 ± 0'                │ 94      │
└─────────┴─────────────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Few Large Files (5 x 20MB) ---
┌─────────┬───────────────────────────────────────────────┬─────────────────────┬──────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                     │ Latency avg (ns)    │ Latency med (ns)     │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼───────────────────────────────────────────────┼─────────────────────┼──────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Pack Few Large Files (5 x 20MB)' │ '49031914 ± 9.05%'  │ '38530688 ± 1720417' │ '24 ± 2.61%'           │ '26 ± 1'               │ 306     │
│ 1       │ 'node-tar: Pack Few Large Files (5 x 20MB)'   │ '46435007 ± 13.18%' │ '25167541 ± 4243625' │ '33 ± 4.47%'           │ '40 ± 8'               │ 325     │
│ 2       │ 'tar-fs: Pack Few Large Files (5 x 20MB)'     │ '50105200 ± 9.43%'  │ '37101563 ± 2584812' │ '24 ± 3.13%'           │ '27 ± 2'               │ 300     │
└─────────┴───────────────────────────────────────────────┴─────────────────────┴──────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

### Unpacking Benchmarks

```sh
--- Many Small Files (2500 x 1KB) ---
┌─────────┬────────────────────────────────────────────────────┬─────────────────────┬───────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                          │ Latency avg (ns)    │ Latency med (ns)      │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼────────────────────────────────────────────────────┼─────────────────────┼───────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Files (2500 x 1KB)' │ '192515278 ± 1.08%' │ '190037188 ± 4838729' │ '5 ± 1.01%'            │ '5 ± 0'                │ 78      │
│ 1       │ 'node-tar: Unpack Many Small Files (2500 x 1KB)'   │ '186057795 ± 0.93%' │ '185001667 ± 4085208' │ '5 ± 0.90%'            │ '5 ± 0'                │ 81      │
│ 2       │ 'tar-fs: Unpack Many Small Files (2500 x 1KB)'     │ '489405277 ± 1.45%' │ '483373125 ± 6424667' │ '2 ± 1.38%'            │ '2 ± 0'                │ 31      │
└─────────┴────────────────────────────────────────────────────┴─────────────────────┴───────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Many Small Nested Files (2500 x 1KB) ---
┌─────────┬───────────────────────────────────────────────────────────┬─────────────────────┬────────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                                 │ Latency avg (ns)    │ Latency med (ns)       │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼───────────────────────────────────────────────────────────┼─────────────────────┼────────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Many Small Nested Files (2500 x 1KB)' │ '209292323 ± 1.11%' │ '208195771 ± 5328125'  │ '5 ± 1.06%'            │ '5 ± 0'                │ 72      │
│ 1       │ 'node-tar: Unpack Many Small Nested Files (2500 x 1KB)'   │ '338143869 ± 0.77%' │ '337274416 ± 4650501'  │ '3 ± 0.74%'            │ '3 ± 0'                │ 45      │
│ 2       │ 'tar-fs: Unpack Many Small Nested Files (2500 x 1KB)'     │ '626920154 ± 1.36%' │ '623576125 ± 15879458' │ '2 ± 1.36%'            │ '2 ± 0'                │ 30      │
└─────────┴───────────────────────────────────────────────────────────┴─────────────────────┴────────────────────────┴────────────────────────┴────────────────────────┴─────────┘

--- Few Large Files (5 x 20MB) ---
┌─────────┬─────────────────────────────────────────────────┬────────────────────┬──────────────────────┬────────────────────────┬────────────────────────┬─────────┐
│ (index) │ Task name                                       │ Latency avg (ns)   │ Latency med (ns)     │ Throughput avg (ops/s) │ Throughput med (ops/s) │ Samples │
├─────────┼─────────────────────────────────────────────────┼────────────────────┼──────────────────────┼────────────────────────┼────────────────────────┼─────────┤
│ 0       │ 'modern-tar: Unpack Few Large Files (5 x 20MB)' │ '46472425 ± 4.19%' │ '44508416 ± 1203000' │ '22 ± 1.01%'           │ '22 ± 1'               │ 323     │
│ 1       │ 'node-tar: Unpack Few Large Files (5 x 20MB)'   │ '26366777 ± 2.41%' │ '23025458 ± 2042708' │ '40 ± 1.74%'           │ '43 ± 4'               │ 569     │
│ 2       │ 'tar-fs: Unpack Few Large Files (5 x 20MB)'     │ '40653022 ± 2.05%' │ '39579084 ± 2008749' │ '25 ± 1.01%'           │ '25 ± 1'               │ 369     │
└─────────┴─────────────────────────────────────────────────┴────────────────────┴──────────────────────┴────────────────────────┴────────────────────────┴─────────┘
```

`modern-tar` is expected to be slower than alternatives due to its focus on zero dependencies, but there is still plenty of room to improve performance and is generally comparable for many usecases due to work being very I/O bound.
